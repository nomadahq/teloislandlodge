<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Book Your Trip — Telo Island Lodge | 2026 Season</title>
<meta name="description" content="Check availability and book your Telo Island Lodge surf trip. 2026 season runs March through October. 7-11 day all-inclusive packages from $594/night.">
<link rel="canonical" href="https://teloislandlodge.com/availability/">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root{--ember:#E8613A;--teal:#0E9AA7;--night:#0B0C0F;--charcoal:#141518;--bone:#F5F0EB;--white:#FAFAF8;--muted:#8A8A8A;--gold:#C8A96E;--green:#3FB950;--ff-display:'Playfair Display',Georgia,serif;--ff-body:'DM Sans',-apple-system,sans-serif}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth;-webkit-font-smoothing:antialiased}
body{font-family:var(--ff-body);color:var(--night);background:var(--night);overflow-x:hidden}
img{max-width:100%;display:block}a{color:inherit;text-decoration:none}
.container{max-width:1280px;margin:0 auto;padding:0 clamp(1.5rem,4vw,4rem)}

nav{position:fixed;top:0;left:0;width:100%;z-index:100;padding:1.5rem clamp(1.5rem,4vw,3rem);display:flex;justify-content:space-between;align-items:center;background:rgba(11,12,15,.92);backdrop-filter:blur(20px) saturate(1.5)}
.nav-logo{font-family:var(--ff-display);font-size:1.05rem;font-weight:600;color:#fff;letter-spacing:.03em}
.nav-logo img{height:28px;display:inline-block;vertical-align:middle;margin-right:.5rem;opacity:.85}
.nav-logo span{vertical-align:middle}
.nav-links{display:flex;gap:2.5rem;align-items:center}
.nav-links a{font-size:.7rem;font-weight:400;letter-spacing:.15em;text-transform:uppercase;color:rgba(255,255,255,.55);transition:color .3s}
.nav-links a:hover{color:#fff}
.nav-cta{padding:.55rem 1.6rem!important;border:1px solid var(--ember)!important;color:var(--ember)!important;font-size:.65rem!important;letter-spacing:.15em;text-transform:uppercase;transition:all .3s}
.nav-cta:hover{background:var(--ember)!important;color:#fff!important}
.hamburger{display:none;flex-direction:column;gap:5px;cursor:pointer;z-index:200}
.hamburger span{width:22px;height:1.5px;background:#fff;transition:all .3s}
.mob-menu{display:none;position:fixed;inset:0;background:var(--night);z-index:150;flex-direction:column;justify-content:center;align-items:center;gap:2.5rem}
.mob-menu.active{display:flex}
.mob-menu a{font-family:var(--ff-display);font-size:2rem;color:#fff;opacity:.7;font-weight:400}

.page-header{padding:clamp(8rem,12vw,10rem) 0 clamp(1.5rem,3vw,2rem);text-align:center}
.page-header .tag{color:var(--gold);font-size:.6rem;letter-spacing:.3em;font-weight:500;text-transform:uppercase;margin-bottom:1.5rem;display:block}
.page-header h1{font-family:var(--ff-display);font-size:clamp(2.2rem,5vw,3.5rem);color:#fff;font-weight:500;margin-bottom:1rem}
.page-header p{color:rgba(255,255,255,.4);font-weight:300;max-width:500px;margin:0 auto;line-height:1.8;font-size:.95rem}

.booking-widget{max-width:900px;margin:0 auto;padding:0 clamp(1.5rem,4vw,4rem)}
.search-bar{background:var(--charcoal);border:1px solid rgba(255,255,255,.08);padding:clamp(1.5rem,3vw,2.5rem);display:grid;grid-template-columns:1fr 1fr auto auto;gap:1rem;align-items:end;margin-bottom:.8rem}
.field label{display:block;font-size:.6rem;letter-spacing:.2em;text-transform:uppercase;color:rgba(255,255,255,.35);margin-bottom:.5rem}
.field select{width:100%;padding:.8rem 1rem;font-family:var(--ff-body);font-size:.9rem;border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.04);color:#fff;outline:none;appearance:none;cursor:pointer;transition:border-color .3s}
.field select:focus{border-color:var(--ember)}
.field select option{background:var(--charcoal);color:#fff}
.search-btn{padding:.8rem 2rem;background:var(--ember);color:#fff;font-family:var(--ff-body);font-size:.75rem;font-weight:500;letter-spacing:.15em;text-transform:uppercase;border:none;cursor:pointer;transition:all .3s;white-space:nowrap}
.search-btn:hover{background:#d4532e}
.reset-btn{padding:.8rem 1.2rem;background:transparent;color:rgba(255,255,255,.35);font-family:var(--ff-body);font-size:.75rem;letter-spacing:.1em;text-transform:uppercase;border:1px solid rgba(255,255,255,.1);cursor:pointer;transition:all .3s;white-space:nowrap}
.reset-btn:hover{color:#fff;border-color:rgba(255,255,255,.3)}
.results-label{font-size:.65rem;letter-spacing:.2em;text-transform:uppercase;color:rgba(255,255,255,.3);margin-bottom:1.5rem;padding-left:.5rem}
.trip-list{display:flex;flex-direction:column;gap:.6rem;margin-bottom:2rem}
.trip-row{display:grid;grid-template-columns:3rem 1fr auto auto auto;gap:clamp(1rem,2vw,2rem);align-items:center;padding:1.2rem 1.5rem;background:var(--charcoal);border:1px solid rgba(255,255,255,.06);transition:all .3s}
.trip-row:hover{border-color:rgba(255,255,255,.12);background:rgba(255,255,255,.04)}
.trip-row.sold-out{opacity:.35}.trip-row.sold-out:hover{opacity:.5}
.trip-num{font-family:var(--ff-display);font-size:1rem;color:var(--gold);font-weight:500;text-align:center}
.trip-dates{display:flex;flex-direction:column;gap:.15rem}
.trip-dates strong{font-size:.95rem;color:#fff;font-weight:500}
.trip-dates span{font-size:.7rem;color:rgba(255,255,255,.35)}
.trip-rate{text-align:right}
.trip-rate strong{font-size:.95rem;color:#fff;font-weight:500;display:block}
.trip-rate span{font-size:.65rem;color:rgba(255,255,255,.3)}
.trip-avail{text-align:center;min-width:80px}
.badge{display:inline-block;padding:.3rem .8rem;font-size:.6rem;font-weight:500;letter-spacing:.1em;text-transform:uppercase;border-radius:2px}
.badge-open{background:rgba(63,185,80,.12);color:var(--green);border:1px solid rgba(63,185,80,.2)}
.badge-few{background:rgba(200,169,110,.1);color:var(--gold);border:1px solid rgba(200,169,110,.2)}
.badge-sold{background:rgba(255,255,255,.04);color:rgba(255,255,255,.25);border:1px solid rgba(255,255,255,.06)}
.trip-action a,.trip-action button{display:inline-block;padding:.5rem 1.5rem;font-size:.65rem;font-weight:500;letter-spacing:.12em;text-transform:uppercase;border:1px solid var(--ember);color:var(--ember);transition:all .3s;cursor:pointer;background:none;font-family:var(--ff-body)}
.trip-action a:hover,.trip-action button:hover{background:var(--ember);color:#fff}
.trip-action.sold button{border-color:rgba(255,255,255,.15);color:rgba(255,255,255,.4)}
.trip-action.sold button:hover{background:rgba(255,255,255,.08);color:rgba(255,255,255,.6);border-color:rgba(255,255,255,.25)}

.included{padding:clamp(3rem,6vw,5rem) 0;background:var(--charcoal);border-top:1px solid rgba(255,255,255,.06)}
.included-inner{max-width:900px;margin:0 auto;padding:0 clamp(1.5rem,4vw,4rem)}
.included h2{font-family:var(--ff-display);font-size:clamp(1.5rem,2.5vw,1.8rem);color:#fff;text-align:center;margin-bottom:2rem;font-weight:500}
.included-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:1.5rem}
.inc-card{padding:1.5rem;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06)}
.inc-card h4{font-family:var(--ff-display);font-size:.95rem;color:#fff;margin-bottom:.5rem;font-weight:500}
.inc-card p{font-size:.82rem;color:rgba(255,255,255,.4);font-weight:300;line-height:1.7}

.inquiry{padding:clamp(3rem,6vw,5rem) 0;background:var(--night);text-align:center}
.inquiry h2{font-family:var(--ff-display);font-size:clamp(1.3rem,2vw,1.6rem);color:#fff;margin-bottom:.5rem;font-weight:500}
.inquiry>p{color:rgba(255,255,255,.35);font-weight:300;font-size:.9rem;margin-bottom:2rem}
.inquiry-form{max-width:500px;margin:0 auto;display:grid;grid-template-columns:1fr 1fr;gap:.8rem}
.inquiry-form input,.inquiry-form select,.inquiry-form textarea{padding:.8rem 1rem;font-family:var(--ff-body);font-size:.85rem;border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.04);color:#fff;outline:none;width:100%}
.inquiry-form input::placeholder,.inquiry-form textarea::placeholder{color:rgba(255,255,255,.25)}
.inquiry-form select{appearance:none;color:rgba(255,255,255,.4)}
.inquiry-form select option{background:var(--night);color:#fff}
.inquiry-form .full{grid-column:1/-1}
.inquiry-form button{grid-column:1/-1;padding:.9rem;background:var(--ember);color:#fff;font-family:var(--ff-body);font-size:.75rem;font-weight:500;letter-spacing:.15em;text-transform:uppercase;border:none;cursor:pointer;transition:all .3s}
.inquiry-form button:hover{background:#d4532e}

.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:200;align-items:center;justify-content:center;backdrop-filter:blur(4px)}
.modal-overlay.active{display:flex}
.modal{background:var(--charcoal);border:1px solid rgba(255,255,255,.1);padding:clamp(2rem,4vw,3rem);max-width:440px;width:90%;position:relative}
.modal-close{position:absolute;top:1rem;right:1.2rem;background:none;border:none;color:rgba(255,255,255,.4);font-size:1.2rem;cursor:pointer}
.modal h3{font-family:var(--ff-display);font-size:1.2rem;color:#fff;margin-bottom:.5rem;font-weight:500}
.modal p{font-size:.85rem;color:rgba(255,255,255,.4);font-weight:300;margin-bottom:1.5rem;line-height:1.7}
.modal .trip-ref{color:var(--gold);font-weight:500}
.modal-form{display:flex;flex-direction:column;gap:.8rem}
.modal-form input{padding:.8rem 1rem;font-family:var(--ff-body);font-size:.85rem;border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.04);color:#fff;outline:none}
.modal-form input::placeholder{color:rgba(255,255,255,.25)}
.modal-form button{padding:.9rem;background:var(--ember);color:#fff;font-family:var(--ff-body);font-size:.75rem;font-weight:500;letter-spacing:.12em;text-transform:uppercase;border:none;cursor:pointer}
.modal-success{display:none;text-align:center;padding:1rem 0}
.modal-success p{color:var(--green);font-weight:500;font-size:.9rem}

/* ── Form States (T5) ── */
.form-loading{position:relative;pointer-events:none;opacity:.6}
.form-loading::after{content:'';position:absolute;top:50%;left:50%;width:24px;height:24px;margin:-12px 0 0 -12px;border:2px solid rgba(255,255,255,.15);border-top-color:var(--ember);border-radius:50%;animation:spin .6s linear infinite;z-index:10}
@keyframes spin{to{transform:rotate(360deg)}}
.btn-loading{position:relative;color:transparent!important;pointer-events:none}
.btn-loading::after{content:'';position:absolute;top:50%;left:50%;width:16px;height:16px;margin:-8px 0 0 -8px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .6s linear infinite}
.form-error{margin-top:.6rem;padding:.6rem 1rem;background:rgba(232,97,58,.1);border:1px solid rgba(232,97,58,.25);color:var(--ember);font-size:.8rem;font-weight:400;display:none}
.form-error.visible{display:block}
.inquiry-success{display:none;text-align:center;padding:2rem 0}
.inquiry-success p{color:var(--green);font-weight:500;font-size:.95rem}
.inquiry-success .sub{color:rgba(255,255,255,.4);font-weight:300;font-size:.85rem;margin-top:.3rem}
.field-error{border-color:var(--ember)!important}

footer{padding:3.5rem 0;background:#050506}
.footer-inner{text-align:center}
.footer-links{margin-bottom:1rem}
.footer-links a{font-size:.65rem;letter-spacing:.15em;text-transform:uppercase;color:rgba(255,255,255,.3);margin:0 .8rem;transition:color .3s}
.footer-links a:hover{color:var(--ember)}
.footer-copy{font-size:.65rem;color:rgba(255,255,255,.15);line-height:1.8}
.footer-copy a{color:rgba(255,255,255,.25)}

@media(max-width:900px){
  .nav-links{display:none}.hamburger{display:flex}
  .search-bar{grid-template-columns:1fr 1fr}
  .trip-row{grid-template-columns:auto 1fr auto;gap:1rem}
  .trip-rate,.trip-avail{display:none}
  .included-grid{grid-template-columns:1fr}
  .inquiry-form{grid-template-columns:1fr}
}
@media(max-width:600px){
  .search-bar{grid-template-columns:1fr}
  .trip-row{grid-template-columns:1fr;text-align:center;gap:.8rem}
  .trip-num{display:none}
}
</style>
</head>
<body>

<nav id="nav">
  <a href="/" class="nav-logo"><img src="/assets/til-icon.png" alt="TIL"><span>Telo Island Lodge</span></a>
  <div class="nav-links">
    <a href="/the-lodge/">The Lodge</a>
    <a href="/the-surf/">The Surf</a>
    <a href="/history/">History</a>
    <a href="/availability/" class="nav-cta">Book Now</a>
  </div>
  <div class="hamburger" onclick="document.querySelector('.mob-menu').classList.toggle('active')"><span></span><span></span><span></span></div>
</nav>
<div class="mob-menu">
  <a href="/the-lodge/" onclick="this.parentElement.classList.remove('active')">The Lodge</a>
  <a href="/the-surf/" onclick="this.parentElement.classList.remove('active')">The Surf</a>
  <a href="/history/" onclick="this.parentElement.classList.remove('active')">History</a>
  <a href="/availability/" onclick="this.parentElement.classList.remove('active')" style="color:var(--ember)">Book Now</a>
</div>

<div class="page-header">
  <span class="tag">2026 Season &middot; March — October</span>
  <h1>Check Availability</h1>
  <p>7-11 day all-inclusive surf packages. Select your preferred month and group size to see what's open.</p>
</div>

<div class="booking-widget">
  <div class="search-bar">
    <div class="field">
      <label>When</label>
      <select id="monthFilter" onchange="filterTrips()">
        <option value="all">Any month</option>
        <option value="Mar">March</option><option value="Apr">April</option><option value="May">May</option>
        <option value="Jun">June</option><option value="Jul">July</option><option value="Aug">August</option>
        <option value="Sep">September</option><option value="Oct">October</option>
      </select>
    </div>
    <div class="field">
      <label>Guests</label>
      <select id="guestFilter" onchange="filterTrips()">
        <option value="0">Any number</option>
        <option value="1">1 guest</option><option value="2">2 guests</option><option value="3">3 guests</option>
        <option value="4">4 guests</option><option value="5">5+ guests</option>
      </select>
    </div>
    <button class="search-btn" onclick="filterTrips()">Search</button>
    <button class="reset-btn" onclick="resetFilters()">Reset</button>
  </div>
  <div class="results-label" id="resultsLabel">Showing all 2026 trips</div>
  <div class="trip-list" id="tripList"></div>
</div>

<section class="included">
  <div class="included-inner">
    <h2>What's Included in Every Trip</h2>
    <div class="included-grid">
      <div class="inc-card"><h4>Accommodation</h4><p>Private room, king-size bed, ensuite, A/C, daily housekeeping, complimentary laundry. Double occupancy — single supplement available.</p></div>
      <div class="inc-card"><h4>All-Inclusive Dining</h4><p>Three meals daily. Fresh seafood, Indonesian-inspired cuisine, tropical fruits. Dietary requirements accommodated with advance notice.</p></div>
      <div class="inc-card"><h4>Surf Transfers &amp; Guiding</h4><p>Unlimited speedboat transfers to 20+ breaks. Expert guides match your ability to conditions. Snorkel, SUP, fishing gear included.</p></div>
      <div class="inc-card"><h4>Charter Flights</h4><p>Return private charter Padang → Telo (~90 min). Meet-and-greet, porters, ground transfers all included.</p></div>
      <div class="inc-card"><h4>2026 Rates</h4><p>$594/night shoulder (Mar-Apr, Sep-Oct). $660/night peak (May-Aug). All-inclusive — extras are only bar, massage, and boards.</p></div>
      <div class="inc-card"><h4>Optional Extras</h4><p>Bar tab. Massage. …Lost Surfboard rentals ($400/trip). Single supplement. <a href="/the-surf/surfboard-rentals/" style="color:var(--ember);font-size:.75rem">View boards →</a></p></div>
    </div>
  </div>
</section>

<section class="inquiry" id="inquiry">
  <h2>Have Questions?</h2>
  <p>Not ready to book? Send us an inquiry and we'll get back to you within 24 hours.</p>
  <div class="inquiry-form" id="inquiryForm">
    <input type="text" id="inqName" placeholder="Full Name" required>
    <input type="email" id="inqEmail" placeholder="Email" required>
    <select id="inqDates"><option value="">Preferred Month</option><option>March 2026</option><option>April 2026</option><option>May 2026</option><option>June 2026</option><option>July 2026</option><option>August 2026</option><option>September 2026</option><option>October 2026</option><option>2027 Season</option></select>
    <select id="inqGroupSize"><option value="">Guests</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option></select>
    <textarea class="full" id="inqMessage" rows="3" placeholder="Questions, skill level, special requests..."></textarea>
    <div class="form-error full" id="inquiryError"></div>
    <button type="button" id="inquiryBtn" onclick="submitInquiry()">Send Inquiry</button>
  </div>
  <div class="inquiry-success" id="inquirySuccess">
    <p>Got it — we'll be in touch within 24 hours.</p>
    <p class="sub">Check your email for a confirmation.</p>
  </div>
</section>

<div class="modal-overlay" id="waitlistModal">
  <div class="modal">
    <button class="modal-close" onclick="closeWaitlist()">&times;</button>
    <div id="waitlistForm">
      <h3>Join the Waitlist</h3>
      <p>We'll notify you if a spot opens on <span class="trip-ref" id="waitlistTrip"></span>. Cancellations happen — be first in line.</p>
      <div class="modal-form">
        <input type="text" id="wlName" placeholder="Full Name" required>
        <input type="email" id="wlEmail" placeholder="Email" required>
        <input type="hidden" id="wlTripId">
        <div class="form-error" id="waitlistError"></div>
        <button id="wlBtn" onclick="submitWaitlist()">Join Waitlist</button>
      </div>
    </div>
    <div class="modal-success" id="waitlistSuccess"><p>You're on the list. We'll email you if a spot opens.</p></div>
  </div>
</div>

<footer>
  <div class="footer-inner container">
    <div class="footer-links"><a href="/the-lodge/">The Lodge</a><a href="/the-surf/">Surf</a><a href="/history/">History</a><a href="/availability/">Book</a></div>
    <p class="footer-copy">&copy; 2026 Telo Island Lodge &middot; Telo Islands, North Sumatra, Indonesia<br>A <a href="https://pegasuslodges.com" target="_blank">Pegasus Lodges</a> property</p>
  </div>
</footer>

<script>
/* ═══════════════════════════════════════════════════════
   TIL Availability — Thread 5: Form Wiring
   Worker: til-concierge-api.aaron-795.workers.dev
   ═══════════════════════════════════════════════════════ */

const WORKER_BASE = 'https://til-concierge-api.aaron-795.workers.dev';
const BL_BASE = 'https://bookings.pegasuslodges.com/en/product/telo-island-lodge-';

// Actual BookingLayer product IDs mapped to trip numbers
const BL_IDS = {2:1,3:45,4:46,5:48,6:47,7:49,8:68,9:50,10:51,11:52,12:53,13:54,14:55,15:56,16:57,17:58,18:59,19:60,20:61,21:62,22:63,23:64,24:65,25:66,26:67};

const TRIPS = [
  {trip:2,month:"Mar",dates:"Mar 8 – 15",len:7,avail:0,rate:594,status:"sold"},
  {trip:3,month:"Mar",dates:"Mar 15 – 26",len:11,avail:5,rate:594,status:"open"},
  {trip:4,month:"Mar",dates:"Mar 26 – Apr 5",len:10,avail:0,rate:594,status:"sold"},
  {trip:5,month:"Apr",dates:"Apr 5 – 15",len:10,avail:5,rate:594,status:"open"},
  {trip:6,month:"Apr",dates:"Apr 15 – 25",len:10,avail:8,rate:594,status:"open"},
  {trip:7,month:"Apr",dates:"Apr 25 – May 5",len:10,avail:0,rate:594,status:"sold"},
  {trip:8,month:"May",dates:"May 5 – 15",len:10,avail:4,rate:660,status:"open"},
  {trip:9,month:"May",dates:"May 15 – 22",len:7,avail:1,rate:660,status:"few"},
  {trip:10,month:"May",dates:"May 22 – Jun 1",len:10,avail:0,rate:660,status:"sold"},
  {trip:11,month:"Jun",dates:"Jun 1 – 11",len:10,avail:0,rate:660,status:"sold"},
  {trip:12,month:"Jun",dates:"Jun 11 – 19",len:8,avail:0,rate:660,status:"sold"},
  {trip:13,month:"Jun",dates:"Jun 19 – 29",len:10,avail:4,rate:660,status:"open"},
  {trip:14,month:"Jun",dates:"Jun 29 – Jul 9",len:10,avail:0,rate:660,status:"sold"},
  {trip:15,month:"Jul",dates:"Jul 9 – 16",len:7,avail:3,rate:660,status:"few"},
  {trip:16,month:"Jul",dates:"Jul 16 – 24",len:8,avail:0,rate:660,status:"sold"},
  {trip:17,month:"Jul",dates:"Jul 24 – Aug 3",len:10,avail:0,rate:660,status:"sold"},
  {trip:18,month:"Aug",dates:"Aug 3 – 13",len:10,avail:0,rate:660,status:"sold"},
  {trip:19,month:"Aug",dates:"Aug 13 – 23",len:10,avail:0,rate:660,status:"sold"},
  {trip:20,month:"Aug",dates:"Aug 23 – Sep 2",len:10,avail:0,rate:660,status:"sold"},
  {trip:21,month:"Sep",dates:"Sep 2 – 12",len:10,avail:0,rate:594,status:"sold"},
  {trip:22,month:"Sep",dates:"Sep 12 – 22",len:10,avail:0,rate:594,status:"sold"},
  {trip:23,month:"Sep",dates:"Sep 22 – Oct 2",len:10,avail:0,rate:594,status:"sold"},
  {trip:24,month:"Oct",dates:"Oct 2 – 12",len:10,avail:9,rate:594,status:"open"},
  {trip:25,month:"Oct",dates:"Oct 12 – 19",len:7,avail:0,rate:594,status:"sold"},
  {trip:26,month:"Oct",dates:"Oct 19 – 29",len:10,avail:9,rate:594,status:"open"},
];

/* ── Trip Rendering ── */
function renderTrips(trips) {
  const list = document.getElementById('tripList');
  if (!trips.length) {
    list.innerHTML = '<div style="text-align:center;padding:3rem;color:rgba(255,255,255,.3)">No trips match. <a href="#" onclick="resetFilters();return false" style="color:var(--ember)">Reset filters</a> or <a href="#inquiry" style="color:var(--ember)">send an inquiry</a>.</div>';
    return;
  }
  list.innerHTML = trips.map(t => {
    const isSold = t.avail === 0;
    const isFew = t.avail > 0 && t.avail <= 3;
    const badgeClass = isSold ? 'badge-sold' : isFew ? 'badge-few' : 'badge-open';
    const badgeText = isSold ? 'Sold Out' : isFew ? `${t.avail} Left` : `${t.avail} Spots`;
    const total = t.rate * t.len;
    const bookUrl = BL_BASE + (BL_IDS[t.trip] || t.trip);
    return `<div class="trip-row${isSold?' sold-out':''}">
        <div class="trip-num">${t.trip}</div>
        <div class="trip-dates"><strong>${t.dates}</strong><span>${t.len} nights · 2026</span></div>
        <div class="trip-rate"><strong>$${total.toLocaleString()}</strong><span>$${t.rate}/night</span></div>
        <div class="trip-avail"><span class="badge ${badgeClass}">${badgeText}</span></div>
        <div class="trip-action${isSold?' sold':''}">
          ${isSold?`<button onclick="openWaitlist(${t.trip},'${t.dates}')">Waitlist</button>`:`<a href="${bookUrl}" target="_blank">Book</a>`}
        </div></div>`;
  }).join('');
}

function filterTrips() {
  const month = document.getElementById('monthFilter').value;
  const guests = parseInt(document.getElementById('guestFilter').value);
  let f = [...TRIPS];
  if (month !== 'all') f = f.filter(t => t.month === month);
  if (guests > 0) f = f.filter(t => t.avail >= guests || t.avail === 0);
  const avail = f.filter(t => t.avail > 0).length;
  document.getElementById('resultsLabel').textContent = (month==='all'&&guests===0)
    ? `Showing all 2026 trips — ${avail} with availability`
    : `${f.length} trips found — ${avail} with availability`;
  renderTrips(f);
}

function resetFilters() {
  document.getElementById('monthFilter').value = 'all';
  document.getElementById('guestFilter').value = '0';
  filterTrips();
}

/* ── Utility: Simple email validation ── */
function isValidEmail(e) { return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e); }

/* ── Utility: Show error on a form ── */
function showError(errorId, msg) {
  const el = document.getElementById(errorId);
  el.textContent = msg;
  el.classList.add('visible');
}
function clearError(errorId) {
  const el = document.getElementById(errorId);
  el.textContent = '';
  el.classList.remove('visible');
}

/* ── Utility: Set loading state on button ── */
function setLoading(btnId, loading) {
  const btn = document.getElementById(btnId);
  if (loading) {
    btn.classList.add('btn-loading');
    btn.disabled = true;
  } else {
    btn.classList.remove('btn-loading');
    btn.disabled = false;
  }
}

/* ══════════════════════════════════════════
   WAITLIST MODAL — POST /waitlist
   ══════════════════════════════════════════ */
function openWaitlist(tripNum, dates) {
  document.getElementById('waitlistTrip').textContent = `Trip ${tripNum} (${dates})`;
  document.getElementById('wlTripId').value = `Trip ${tripNum} - ${dates}`;
  document.getElementById('waitlistForm').style.display = 'block';
  document.getElementById('waitlistSuccess').style.display = 'none';
  document.getElementById('wlName').value = '';
  document.getElementById('wlEmail').value = '';
  clearError('waitlistError');
  setLoading('wlBtn', false);
  document.getElementById('waitlistModal').classList.add('active');
  document.getElementById('wlName').focus();
}

function closeWaitlist() {
  document.getElementById('waitlistModal').classList.remove('active');
}

async function submitWaitlist() {
  const name = document.getElementById('wlName').value.trim();
  const email = document.getElementById('wlEmail').value.trim();
  const trip = document.getElementById('wlTripId').value;

  // Clear previous errors
  clearError('waitlistError');
  document.getElementById('wlName').classList.remove('field-error');
  document.getElementById('wlEmail').classList.remove('field-error');

  // Validate
  if (!name) { document.getElementById('wlName').classList.add('field-error'); showError('waitlistError', 'Please enter your name.'); return; }
  if (!email || !isValidEmail(email)) { document.getElementById('wlEmail').classList.add('field-error'); showError('waitlistError', 'Please enter a valid email address.'); return; }

  // Loading state
  setLoading('wlBtn', true);

  try {
    const res = await fetch(`${WORKER_BASE}/waitlist`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, name, trip })
    });

    if (!res.ok) {
      const errData = await res.json().catch(() => ({}));
      throw new Error(errData.error || `Server error (${res.status})`);
    }

    // Success
    document.getElementById('waitlistForm').style.display = 'none';
    document.getElementById('waitlistSuccess').style.display = 'block';
    setTimeout(closeWaitlist, 3500);

  } catch (err) {
    console.error('Waitlist submit error:', err);
    showError('waitlistError', 'Something went wrong — please try again or email info@teloislandlodge.com directly.');
    setLoading('wlBtn', false);
  }
}

// Close modal on overlay click
document.getElementById('waitlistModal').addEventListener('click', function(e) { if(e.target===this) closeWaitlist(); });
// Close modal on Escape
document.addEventListener('keydown', function(e) { if(e.key==='Escape') closeWaitlist(); });


/* ══════════════════════════════════════════
   INQUIRY FORM — POST /inquiry
   ══════════════════════════════════════════ */
async function submitInquiry() {
  const name = document.getElementById('inqName').value.trim();
  const email = document.getElementById('inqEmail').value.trim();
  const dates = document.getElementById('inqDates').value;
  const groupSize = document.getElementById('inqGroupSize').value;
  const message = document.getElementById('inqMessage').value.trim();

  // Clear previous errors and highlights
  clearError('inquiryError');
  ['inqName','inqEmail'].forEach(id => document.getElementById(id).classList.remove('field-error'));

  // Validate required fields
  if (!name) { document.getElementById('inqName').classList.add('field-error'); showError('inquiryError', 'Please enter your name.'); return; }
  if (!email || !isValidEmail(email)) { document.getElementById('inqEmail').classList.add('field-error'); showError('inquiryError', 'Please enter a valid email address.'); return; }

  // Loading state
  setLoading('inquiryBtn', true);

  try {
    const res = await fetch(`${WORKER_BASE}/inquiry`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, name, groupSize, dates, message })
    });

    if (!res.ok) {
      const errData = await res.json().catch(() => ({}));
      throw new Error(errData.error || `Server error (${res.status})`);
    }

    // Success — hide form, show confirmation
    document.getElementById('inquiryForm').style.display = 'none';
    document.getElementById('inquirySuccess').style.display = 'block';

  } catch (err) {
    console.error('Inquiry submit error:', err);
    showError('inquiryError', 'Something went wrong — please try again or email info@teloislandlodge.com directly.');
    setLoading('inquiryBtn', false);
  }
}

/* ── Clear field-error on input ── */
document.querySelectorAll('.inquiry-form input, .inquiry-form textarea, .modal-form input').forEach(el => {
  el.addEventListener('input', function() { this.classList.remove('field-error'); });
});

/* ── Allow Enter to submit in waitlist modal ── */
document.querySelectorAll('#wlName, #wlEmail').forEach(el => {
  el.addEventListener('keydown', function(e) { if(e.key==='Enter') submitWaitlist(); });
});

/* ── Init ── */
filterTrips();
</script>
</body>
</html>
